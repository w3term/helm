{{- $urls := list -}}
{{- range $key, $value := .Values.github_applications -}}
  {{- $parsed := urlParse $value.website_url -}}
  {{- $urls = append $urls (printf "%s://%s" $parsed.scheme $parsed.host) -}}
{{- end -}}

apiVersion: v1
kind: ConfigMap
metadata:
  name: auth
  labels:
    app.kubernetes.io/component: authentication
data:
  {{- if .Values.github_org_name }}
  GITHUB_ORG_NAME: {{ .Values.github_org_name}}
  {{- end }}
  ALLOWED_ORIGINS: "{{ join "," $urls }}"